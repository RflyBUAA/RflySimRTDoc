<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://rflysimRT.github.io/quickstart/%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>简介 - RflySim-RT</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "\u7b80\u4ecb";
        var mkdocs_page_input_path = "quickstart/\u5feb\u901f\u5f00\u59cb.md";
        var mkdocs_page_url = "/quickstart/%E5%BF%AB%E9%80%9F%E5%BC%80%E5%A7%8B/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> RflySim-RT
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">快速开始</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">简介</a>
    <ul class="current">
    </ul>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">帮助</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../help/updatedoc/">如何更新文档</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">RflySim-RT</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">快速开始</li>
      <li class="breadcrumb-item active">简介</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="1">1. 平台特点</h1>
<ul>
<li>[x] ARM A53单核裸机, 采用简单的时间片轮询. </li>
<li>[x] <a href="https://github.com/NevermindZZT/letter-shell">Letter Shell</a>终端支持, 方便用户交互. 网上还有一个叫xc_shell.</li>
<li>[x] <a href="http://elm-chan.org/fsw/ff/00index_e.html">FATFS</a>文件系统实现对SD卡的基本操作 网上还有一个叫littlefs</li>
<li>[x] 串口wifi模块无线传输显示数据到RflySim3D显示软件, </li>
<li>[x] 串口wifi模块参数可以通过串口Shell修改</li>
<li>[x] 默认2000Hz中断实时运行多旋翼模型</li>
<li>[x] 模型参数(<a href="https://github.com/DaveGamble/cJSON">cJSON</a>)可修改. 模型参数文件预先存放到SD卡, 或者PC端远程修改模型参数, 参数可以远程保存, 多参数文件支持,便于快速切换模型</li>
</ul>
<hr />
<ul>
<li>[ ] 采用PX4 ulog日志格式, 与飞控的ulog文件采用相同的API处理.</li>
<li>[ ] 对MAVLINK的支持, QGC地面站修改模型参数, 甚至接入控制台</li>
<li>[ ] PC端故障注入</li>
<li>[ ] 更好的交互体验, PC端实现对仿真模型运行的控制(shell和PC上位机), 开发版上电后需要手动选择模型, 手动选择开始仿真, 并且手动停止模型, 软件重置模型.</li>
<li>[ ] ls cd rm cat等文件操作函数的实现</li>
</ul>
<h1 id="2">2. 硬件连接</h1>
<h2 id="21">2.1 关键硬件清单</h2>
<ul>
<li>ALINX MPSoC开发板, 开发板型号AXU2CG-E, 主控芯片型号XCZU2CG-SFVC784-1-E</li>
<li>Pixhawk 4</li>
<li>GH1.25转杜邦连接线</li>
<li><a href="https://detail.tmall.com/item.htm?spm=a230r.1.14.18.69a09754bcIZd5&amp;id=609757779633&amp;ns=1&amp;abbucket=8&amp;skuId=4447338308660">正点原子串口转wifi模块</a></li>
</ul>
<h2 id="23">2.3 硬件接口定义图</h2>
<p>将飞控与开发板对应引脚使用GH1.25杜邦线对应连接在一起, 引脚定义查看下面几副图.  </p>
<p>**pixhawk 4 接口定义图, **</p>
<blockquote>
<p><strong>每个接口的左数第一个引脚是PIN 1, 也就是VCC</strong></p>
</blockquote>
<p><img alt="image.png" src="https://cdn.nlark.com/yuque/0/2021/png/1166025/1627393529101-bbd46a6d-b028-48f9-b1b0-a6badc5ada6e.png#averageHue=%23ececec&amp;height=506&amp;id=u1c6491a7&amp;originHeight=506&amp;originWidth=428&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=46557&amp;status=done&amp;style=none&amp;title=&amp;width=428" /><img alt="image.png" src="https://cdn.nlark.com/yuque/0/2021/png/1166025/1627450886931-a7743dbe-4e5b-4b0d-97b2-ea6686ae5a51.png#averageHue=%23889792&amp;height=503&amp;id=uf8126912&amp;originHeight=648&amp;originWidth=681&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=946513&amp;status=done&amp;style=none&amp;title=&amp;width=529" /><img alt="image.png" src="https://cdn.nlark.com/yuque/0/2021/png/1166025/1627393619541-fd66ba9d-cb8c-450d-bf8c-02481b2a5b9d.png#averageHue=%23f4f3f3&amp;height=472&amp;id=u5bafd894&amp;originHeight=472&amp;originWidth=631&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=44326&amp;status=done&amp;style=none&amp;title=&amp;width=631" /><img alt="image.png" src="https://cdn.nlark.com/yuque/0/2021/png/1166025/1627393693107-afb43656-12c8-46db-96f1-55970b879e00.png#averageHue=%23f2f2f1&amp;height=541&amp;id=uea23bbf0&amp;originHeight=541&amp;originWidth=610&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=54559&amp;status=done&amp;style=none&amp;title=&amp;width=610" />
<img alt="image.png" src="https://cdn.nlark.com/yuque/0/2021/png/1166025/1627393717322-62410e1c-ac24-4bff-a627-32462a05eb9c.png#averageHue=%23f4f3f2&amp;height=714&amp;id=u6d916738&amp;originHeight=714&amp;originWidth=627&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=69934&amp;status=done&amp;style=none&amp;title=&amp;width=627" /><img alt="image.png" src="https://cdn.nlark.com/yuque/0/2021/png/1166025/1627393763560-84d2655c-e2a3-48df-995c-7c4f8fccc813.png#averageHue=%23f2f2f1&amp;height=541&amp;id=ud649b3cf&amp;originHeight=541&amp;originWidth=617&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=57279&amp;status=done&amp;style=none&amp;title=&amp;width=617" />
<a href="https://www.yuque.com/attachments/yuque/0/2021/pdf/1166025/1627387378406-23e412b3-557b-4c01-bcb7-93daf58663f1.pdf">Pixhawk4-Pinouts.pdf</a>
<strong>开发板IO接口定义图, 管脚和红框中的定义标记依次对应</strong>
<img alt="开发板管脚定义.png" src="https://cdn.nlark.com/yuque/0/2022/png/1166025/1651756798075-09daedfc-e1e9-42d0-aac4-1bae9356ed41.png#averageHue=%23889d87&amp;clientId=u50b462d9-52dd-4&amp;from=drop&amp;id=u187c2ac2&amp;originHeight=1191&amp;originWidth=1739&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=2924980&amp;status=done&amp;style=none&amp;taskId=ubb531707-86c7-4ecd-9703-cf8405667d6&amp;title=" />
如上图, 将串口wifi模块安装到开发板对应的位置上(位置见上图左下角).  效果图如下
<img alt="image.png" src="https://cdn.nlark.com/yuque/0/2021/png/1166025/1627398665804-20ddf57c-881a-4e30-9eb3-e97b722219c7.png#averageHue=%236b7274&amp;height=434&amp;id=u6f8a0674&amp;originHeight=737&amp;originWidth=821&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=799912&amp;status=done&amp;style=none&amp;title=&amp;width=484" /></p>
<h2 id="24">2.4 其他连接</h2>
<ol>
<li>连接开发板的PS串口到电脑(该串口可用于系统调试, 建议使用<a href="https://mobaxterm.mobatek.net/"><strong>MobaXterm</strong></a>[Putty](https://www.chiark.greenend.org.uk/~sgtatham/putty/)[SecureCRT](https://www.vandyke.com/products/securecrt/index.html)之类的软件连接串口, 实现命令行功能, 串口助手之类的软件体验稍差)</li>
<li>开发板电源(<a href="https://item.taobao.com/item.htm?spm=a1z09.2.0.0.32f12e8dZlbJXh&amp;id=599221327119&amp;_u=rqvdro2801a">可以购买带开关的DC电源线, 免去电源插拔的繁琐操作</a>)</li>
</ol>
<h1 id="3">3. 飞控固件设置</h1>
<p>SocFPGA HIL仿真平台通过模拟真实的传感器实现半物理仿真, 故而需要让飞控默认使用外置传感器与开发板进行通信, 故而<strong>需要对飞控的传感器启动脚本进行简单修改重新编译烧录到飞控中</strong>. 
<strong>飞控固件支持的版本是v1.11，对于v1.12的支持请参考</strong><a href="https://www.yuque.com/rflysocfpgahil/lkdltx/goxg0w?view=doc_embed">如何使用PX4 1.12固件</a><strong>, ** 对于使用RflySim可以在安装目录下找到飞控固件目录</strong>X:\PX4PSP\Firmware\boards\px4\fmu-v5\init\中的rc.board_sensors文件, **</p>
<blockquote>
<p>如果使用官方原生固件, 同理, 也需要到对应的目录Firmware\boards\px4\fmu-v5\init\下修改rc.board_sensors文件, 需要修改内容也是一样的</p>
</blockquote>
<p>使用编辑器打开rc.board_sensors, 建议使用vscode之类的编辑软件编辑, 修改如下</p>
<pre><code class="language-shell">#!/bin/sh
#
# PX4 FMUv5 specific board sensors init
#------------------------------------------------------------------------------

adc start
if ! icm20689 -S start
then
# Internal SPI bus ICM-20602
#icm20602 -s -R 2 start

# Internal SPI bus ICM-20689
icm20689 -s -R 2 start

# Internal SPI bus BMI055 accel/gyro
#bmi055 -A -R 2 -s start
#bmi055 -G -R 2 -s start

# internal compass
#ist8310 -I start
fi

if ! ms5611 -X start
then
# Baro on internal SPI
ms5611 -s start
fi
#icm20689 -S start
#ms5611 -X start
</code></pre>
<p>修改后的脚本逻辑是优先启动外置传感器, 如果启动失败则会启动内置传感器, 这样相同的固件可以不经修改既可以运行在本仿真平台上, 也可以实飞. 当然了, 还是建议仿真一个飞控, 实飞一个飞控.
<strong>请再次确认飞控中安装的PX4飞控固件版本是1.11.3版本!</strong>
<strong>并且飞控的模式是四旋翼!</strong></p>
<h1 id="4">4. 固件参数设置</h1>
<p><img alt="image.png" src="https://cdn.nlark.com/yuque/0/2022/png/1166025/1645510605585-f56a5cab-38cb-46b7-93a5-92def97cd6aa.png#averageHue=%23282524&amp;clientId=u08cbd0eb-5f2e-4&amp;from=paste&amp;height=29&amp;id=uf7b9a51d&amp;originHeight=27&amp;originWidth=640&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=5828&amp;status=done&amp;style=none&amp;taskId=u4d86f03d-69a0-406a-b10f-8e0d3dbf3ee&amp;title=&amp;width=692" />
<img alt="image.png" src="https://cdn.nlark.com/yuque/0/2022/png/1166025/1645510733198-50b354c6-e1cd-4e29-a958-267e0006d63b.png#averageHue=%232a2725&amp;clientId=u08cbd0eb-5f2e-4&amp;from=paste&amp;height=34&amp;id=uebd37f1e&amp;originHeight=30&amp;originWidth=618&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=7849&amp;status=done&amp;style=none&amp;taskId=ucfdcfeab-6d4f-448e-bec2-5c6741fdb75&amp;title=&amp;width=692" /></p>
<h1 id="5">5. 开发板固件安装</h1>
<p>开发板采用SD启动方式. 步骤如下:</p>
<ol>
<li>
<p>从开发板上取下SD卡, 使用读卡器将固件复制到SD卡根目录上.  固件下载链接：<a href="https://bhpan.buaa.edu.cn:443/link/1FF3201F500F3D00A9C483235A36B653">https://bhpan.buaa.edu.cn:443/link/    1FF3201F500F3D00A9C483235A36B653</a>有效期限：2023-09-01 23:59</p>
<blockquote>
<p><strong>SD卡需要提前格式化为FAT32格式!! 一般默认也是FAT32格式. **
</strong>固件的名字必须是BOOT.bin**</p>
</blockquote>
</li>
<li>
<p>确保开发板的上电启动模式为SD卡模式(需要设置拨码开关).</p>
<blockquote>
<p>拨码开关设置参考下图, 应设置为0101, 对应到图中从左到右是<strong>上下上下</strong>
<img alt="image.png" src="https://cdn.nlark.com/yuque/0/2021/png/1166025/1627396480265-8544e806-bcf6-4f0c-90a4-4988783e9080.png#averageHue=%231f211e&amp;height=207&amp;id=vJWr5&amp;originHeight=396&amp;originWidth=1160&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=810277&amp;status=done&amp;style=none&amp;title=&amp;width=605" /></p>
</blockquote>
</li>
<li>
<p>将SD卡插回到开发板上.</p>
</li>
</ol>
<p>完成以上设置后, 给开发板通电, 并且连接USB到电脑, 可以在设备管理器中看到(<strong>可能需要安装驱动</strong>), 使用串口终端连接串口
<img alt="image.png" src="https://cdn.nlark.com/yuque/0/2021/png/1166025/1627396642253-0f6ee54e-6d5b-46c9-a37d-6b2bbcdedeae.png#averageHue=%23f5f1ed&amp;height=42&amp;id=udbbda1a3&amp;originHeight=42&amp;originWidth=387&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=7032&amp;status=done&amp;style=none&amp;title=&amp;width=387" />
这里使用MobaXterm举例打开串口, 波特率设置为115200, 打开后在串口终端里输入<strong>help</strong>并且<strong>回车</strong><img alt="shell.gif" src="https://cdn.nlark.com/yuque/0/2021/gif/1166025/1627397344446-6c638b00-be4e-493a-9173-5699fe8b41ee.gif#averageHue=%23fcfcfb&amp;height=909&amp;id=u456abdcb&amp;originHeight=909&amp;originWidth=1627&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=621814&amp;status=done&amp;style=none&amp;title=&amp;width=1627" />
当然也可以先连接串口再打开开发板, 或者按下开发板的复位键, 应该能看到更多启动信息
<img alt="shell2.gif" src="https://cdn.nlark.com/yuque/0/2021/gif/1166025/1627397631533-cf07ba30-2b24-49d6-9575-f814a48c3e06.gif#averageHue=%23262626&amp;height=778&amp;id=u638e1feb&amp;originHeight=778&amp;originWidth=1383&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=301592&amp;status=done&amp;style=none&amp;title=&amp;width=1383" />
如果连接了串口转wifi模块, 此时打开RflySim3D软件应该可以看到一架四旋翼飞行器出现在窗口中(如果没有显示，可能是被防火墙拦截，可以先关闭防火墙)
<img alt="image.png" src="https://cdn.nlark.com/yuque/0/2021/png/1166025/1627397741790-b8d942db-2165-4b31-9297-0d349db6c5f7.png#averageHue=%234d5b39&amp;height=720&amp;id=u4672d79d&amp;originHeight=720&amp;originWidth=1280&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=2027812&amp;status=done&amp;style=none&amp;title=&amp;width=1280" /></p>
<h1 id="6">6. 飞控上电</h1>
<p>此时为飞控连接电脑(确保已经按照前面步骤重刷修改过启动脚本的固件), 打开QGC可以看到地面站连接到飞控. 在地面站的控制台中输入sensors status 回车, 可以看到飞控读取到的传感器信息. 这里演示的QGC版本比较新, 旧版本操作可能有出入但是基本相同.<img alt="QGC.gif" src="https://cdn.nlark.com/yuque/0/2021/gif/1166025/1627398206891-71b4ba41-5aa9-42d5-94b8-8703440db8fa.gif#averageHue=%235d6769&amp;height=913&amp;id=ufc1a3e51&amp;originHeight=913&amp;originWidth=1708&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=7495071&amp;status=done&amp;style=none&amp;title=&amp;width=1708" />
如果配置过程没问题得话, 可以获得传感器状态信息如下, 这些传感器数据实际上是FPGA模拟出来的, 飞控却会认为这是真实的传感器.<br />
<img alt="image.png" src="https://cdn.nlark.com/yuque/0/2021/png/1166025/1627398254378-871db728-274a-4df1-b0ba-6be5ac84584a.png#averageHue=%23383635&amp;height=766&amp;id=ud5bafd89&amp;originHeight=766&amp;originWidth=781&amp;originalType=binary&amp;ratio=1&amp;rotation=0&amp;showTitle=false&amp;size=179455&amp;status=done&amp;style=none&amp;title=&amp;width=781" />
如果没有上图效果请再次确认</p>
<ul>
<li>飞控的Px4 版本是1.11.3.</li>
<li>且飞行模式是四旋翼模式.</li>
<li>确认飞控和开发板物理接线正确. </li>
<li>检查地线是否正确连接.</li>
</ul>
<h1 id="_1">本节完毕[</h1>
<p>](https://www.aliyundrive.com/s/P4Ghb11ukme)</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../help/updatedoc/" class="btn btn-neutral float-right" title="如何更新文档">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
      <span><a href="../../help/updatedoc/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
